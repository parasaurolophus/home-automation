<html>

<head>

    <title>Home Automation Dashboard</title>

    <link href="dashboard.css" rel="stylesheet" />

    <script src="dashboard.js"></script>

</head>

<body>

    <header>

        <h1>Home Automation Dashboard</h1>

        <p>
            Home automation <a href="#dashboard">dashboard</a> and device
            <a href="#controls">controls</a> implemented as a single-page web application, using
            <a href="https://nodered.org" target="_blank">Node-RED</a> for its back end
        </p>

        <p>
            <a href="#more-information">More information</a>
        </p>

    </header>

    <hr />

    <a id="dashboard"></a>
    <section>

        <h2>Dashboard</h2>

        <p>
            Automation server settings and device management controls
        </p>

        <div class="wrapped">

            <fieldset>

                <legend>Message Broker</legend>

                <p>
                    Monitor and control the connection to the <a href="https://nodered.org" target="_blank">Node-RED</a>
                    back end
                </p>

                <div>

                    <label for="ws-url">
                        URL
                    </label>

                    <input id="ws-url" />

                </div>

                <div class="columns">

                    <button id="reconnect-ws" onclick="connectWS(event)">
                        Connect
                    </button>

                    <span id="ws-status"></span>

                    <button id="reconnect-ws" onclick="disconnectWS(event)">
                        Disconnect
                    </button>

                </div>

            </fieldset>

            <fieldset id="settings" disabled="true">

                <legend>Settings</legend>

                <div class="padded">

                    <div>

                        <input type="checkbox" id="settings-shades" onchange="settingsCheckboxChanged(event)" />

                        <label for="settings-shades">
                            Enable window shades automation
                        </label>

                    </div>

                    <div>

                        <input type="checkbox" id="settings-lighting" onchange="settingsCheckboxChanged(event)" />

                        <label for="settings-lighting">
                            Enable lighting automation
                        </label>

                    </div>

                </div>

                <div class="padded">

                    <p>
                        Bedtime will be at the time selected here plus or minus a randomly chosen offset of up to 30
                        minutes that changes each day:
                    </p>

                    <label for="settings-bedtime">Bedtime</label>

                    <select id="settings-bedtime" onchange="bedtimeChanged(event)">
                        <option id="9PM" value="21"> 9PM</option>
                        <option id="10PM" value="22">10PM</option>
                        <option id="11PM" value="23">11PM</option>
                    </select>

                </div>

                <div class="padded">

                    <div>

                        <p>
                            Instruct the back end to recreate all dynamically generated controls:
                        </p>

                        <button id="controls-refresh" onclick="refreshControlsClicked(event)">
                            Refresh Controls
                        </button>

                    </div>

                </div>

            </fieldset>

            <fieldset id="hue-bridges-fields" disabled="true">

                <legend>Hue Bridges</legend>

                <div id="hue-bridges">
                    <p>unknown</p>
                </div>

            </fieldset>

            <fieldset>

                <legend>Status</legend>

                <div class="padded">
                    Sunrise:
                    <span id="daily-sunrise"></span>
                </div>

                <div class="padded">
                    Sunset:
                    <span id="daily-sunset"></span>
                </div>

                <div class="padded">
                    Bedtime:
                    <span id="daily-bedtime"></span>
                </div>

                <div class="padded">
                    Theme:
                    <span id="daily-theme"></span>
                </div>

                <div class="padded">
                    Time:
                    <span id="timer-time"></span>
                </div>

                <div id="automation-trigger" class="padded"></div>

                <div id="hue-key" class="padded"></div>

            </fieldset>

        </div>

    </section>

    <a id="controls"></a>
    <section>

        <h2>Controls</h2>

        <p>
            Dynamically generated controls for home automation devices
        </p>

        <section id="controls-container" class="not-wrapped">
            <p>
                none
            </p>
        </section>

    </section>

    <hr />

    <a id="more-information"></a>
    <section>

        <div class="wrapped">

            <dl>

                <dt>Node-RED</dt>
                <dd>
                    <a href="https://nodered.org" target="_blank">
                        https://nodered.org
                    </a>
                </dd>

                <dt>node-red-node-discovery</dt>
                <dd>
                    <a href="https://flows.nodered.org/node/node-red-node-discovery" target="_blank">
                        https://flows.nodered.org/node/node-red-node-discovery
                    </a>
                </dd>

                <dt>@parasaurolophus/node-red-eventsource</dt>
                <dd>
                    <a href="https://flows.nodered.org/node/@parasaurolophus/node-red-eventsource" target="_blank">
                        https://flows.nodered.org/node/@parasaurolophus/node-red-eventsource
                    </a>
                </dd>

                <dt>suncalc</dt>
                <dd>
                    <a href="https://www.npmjs.com/package/suncalc" target="_blank">
                        https://www.npmjs.com/package/suncalc
                    </a>
                </dd>

            </dl>

            <div>

                <p>PowerView API</p>

                <ul>
                    <li>
                        <a href="https://motorisation.hde.nl/hd/powerview/general-guides/API/" target="_blank">
                            https://motorisation.hde.nl/hd/powerview/general-guides/API/
                        </a>
                    </li>
                </ul>

            </div>

            <div>

                <p>Hue Bridge API V2</p>

                <ul>
                    <li>
                        <a href="https://developers.meethue.com/develop/hue-api-v2/" target="_blank">
                            https://developers.meethue.com/develop/hue-api-v2/
                        </a>
                    </li>
                    <li>
                        <a href="https://developers.meethue.com/develop/hue-api-v2/core-concepts/#events"
                            target="_blank">
                            https://developers.meethue.com/develop/hue-api-v2/core-concepts/#events
                        </a>
                    </li>
                    <li>
                        <a href="https://developers.meethue.com/develop/application-design-guidance/hue-bridge-discovery/"
                            target="_blank">
                            https://developers.meethue.com/develop/application-design-guidance/hue-bridge-discovery/
                        </a>
                    </li>
                </ul>

            </div>

        </div>

    </section>

    <script>
        document.querySelector('#ws-url').value = wsURL(window.location)
        connectWS()
    </script>

</body>